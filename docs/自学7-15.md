## 自学7-17



### 涉及到的内容

* Isolation
* Defensive
* Kernel/User mode
* System call



### Isolation 隔离性

* 含义：在不同的应用程序之间有强隔离性
* 目的：实现multiplexing和内存隔离
* 从隔离的角度看Unix的接口
  * 精心设计以实现资源的强隔离
  * 实现方法：
    * ==**抽象硬件资源**==
    * 操作系统不是直接将CPU提供给应用程序，而是==**向应用程序提供进程**==，进程抽象了CPU，这样操作系统才能在多个应用程序之间复用一个或者多个CPU
      * 实例：RISC-V处理器实际上是有4个核，支持同时运行4个进程，一个进程占用一个核；操作系统：假设有8个或者7个应用程序，操作系统会==**分时**==复用这些CPU核。比如一个进程运行100毫秒，之后内核会停止运行并将那个进程从CPU中卸载，再加载另一个应用程序并再运行100毫秒。
    * ==**exec：实现内存的抽象**==
      * 使用exec时，传入一个文件名，它对应了一个应用程序的内存镜像，里面包含了程序对应的指令，全局的数据，应用程序可以逐渐扩展自己的内存。例如，通过调用SBRK并通过扩展其数据段来扩展它。==**应用程序没有直接访问物理内存的权限（原因：操作系统会提供内存隔离并控制内存，会在应用程序和硬件资源之间提供一个中间层）**==
    * ==**files：实现磁盘的抽象**==
      * Unix中，与存储系统交互的唯一方式就是通过files
      * files提供了非常方便的磁盘抽象，操作系统会决定如何将文件与磁盘中的块对应，确保一个磁盘块只出现在一个文件中，确保用户A不能操作用户B的文件。



### Defensive 预防性

* 做好准备抵御来自应用程序的攻击

* 应用程序不能打破对它的隔离

  ==**---->意味着我们需要在应用程序和操作系统之间提供强隔离性**==

  * 通过硬件来实现这种强隔离性
    * user/kernel mode（在RISC-V中称为监督模式）
    * 虚拟内存（virtual memory）



### User/Kernel Mode

* kernel mode下，CPU可以运行特殊权限的指令，user mode下，普通权限的指令。
  * 特殊权限指令：直接操纵硬件，不允许在user mode执行特殊权限指令
  * 普通权限指令：add, sub, branch等
* 处理器中有一个bit，当它为1的时候是user mode，当它为0的时候是kernel mode
  * 设置这个bit位的指令并须是特殊权限指令
